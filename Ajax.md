# Ajax  
### 1. 什么是Ajax  
	asynchronous javascript and XML, 是几种技术的集合。  
### 2. 为什么要使用Ajax  
	* Ajax通过异步模式提升了用户体验  
	* 优化浏览器和服务器之间的传输，减少不必要的数据往返，减少带宽占用  
	* Ajax引擎在客户端运行，承担了一部分本来由服务器端承担的工作，减少了大量用户下的服务器负载  
### 3. 缺点  
	* 不支持浏览器back按钮  
	* 安全问题。Ajax暴露了与服务器交互的细节  
	* 对搜索引擎的支持比较弱  
### 4. 使用基础  
##### HTTP请求  
* ###### http是一种无状态协议；  
* 一个完整的HTTP请求过程通常有以下7个步骤：  
	1.建立TCP连接；  
	2.浏览器向服务器发送请求命令；  
	3.浏览器发送请求头部信息  
	4.服务器应答  
	5.服务器发送应答头信息  
	6.服务器向浏览器发送数据  
	7.服务器关闭TCP连接  
* ###### 一个http请求一般由四部分组成  
	1.HTTP请求的方法或动作，比如是GET还是POST请求  
		GET：
        一般用于信息获取，(有幂等的特点)  
        使用URL传递参数，  
        对所发送信息数量有限制，一般在2000个字符左右；  

		POST：
        一般用于修改服务器上的资源，  
        对所发送的信息数量无限制。

        使用POST方式来向服务器POST数据时需要使用setRequestHeader(header,value)方法来添加http头；然后在send里面传递希望发送的数据。  
        
        xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");  
	2.正在请求的URL，  
	3.请求头，包含一些客户端环境，身份验证信息等  
	4.请求体，也就是请求正文，请求正文中可以包含客户提交的查询字符串信息，表单信息等等。  
* ###### 一个HTTP响应一般由三部分组成：  
	1. 一个数字和文字组成的状态码，用来显示请求是成功还是失败；  
    	状态码类型：  
        1XX：信息类，表示收到浏览器请求，正在进一步处理中；  
    	2XX：成功，表示用户请求被正确接收和处理。例如 200 OK  
    	3XX：重定向，表示请求没有成功，客户必须采取进一步动作  
    	4XX：客户端错误，客户端提交的请求有错误，例如404  
    	5XX：服务器错误，表示服务器不能完成对请求的处理。  
        
    2. 响应头，响应头也和请求头一样包含许多有用信息，例如服务器类型，日期时间，内容类型和长度等  
    
    3. 响应体，也就是响应正文  
		① 创建XMLHttpRequest对象，也就是创建一个异步调用对象  
    		XMLHttpRequest的三个重要属性：  
    
            | 属性	| 描述 |  
            | --- | --- |  
            |  onreadystatechange |	存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。 |  
            |readyState	| 存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。|  
        
            •	0: 请求未初始化  
            •	1: 服务器连接已建立  
            •	2: 请求已接收  
            •	3: 请求处理中  
            •	4: 请求已完成，且响应已就绪  
            status	200: "OK"  
            404: 未找到页面  
  
        ② 发送请求  
            open(method,url,async)  
            send(string)  
                将请求发送到服务器  
                string仅用于POST请求  
            *当使用get方式时，参数使用？拼接到url地址之后，多个参数之间使用&连接，当使用POST方式时，需在send(string)里string处传入参数  
            *当无法使用缓存文件(更新服务器上的文件或数据库时)；向服务器发送大量数据时；发送包含未知字符的用户输入时；应该使用POST请求。  

        ③ 取得响应  
            responseText：获得字符串形式的相应数据  
            responseXML：获得XML形式的响应数据  
            status和statusText：以数字或文本形式返回HTTP状态码(接受了请求并且返回了数据，只是有可能出现诸如找不到文件这种情况。是一种基于成功向服务器发送请求并被处理了的情况之上的状态。)  
        	getALLresponseHeader()：获取所有响应头  
            getResponseHeader()：查询响应中某个字段的值  
            
        ④ 获取响应状态  
            readyStates属性：  
			0：请求还未初始化，open还没调用  
			1：服务器连接已经建立，open已经调用  
			2：请求已接收，    
			3：请求处理中    
			4：请求已完成，且响应就绪    
            
#### JSON    
* 是JavaScript对象表示法(JavaScript Object Notation)一种数据格式 *特点：必须使用双引号；  
* 数值必须以十进制表示；  
* 不能使用NaN和infinity，undefined  
* JSON的数据类型可以是简单类型也可以是对象、数组；  
*对象的键名必须放在双引号里，JSON不是JS语句，所以末尾不需要加分号；同一个对象中不应该出现两个同名属性  
* JSON是存储和交换文本信息的语法，类似XML。它采用键值对的方式来组织，易于阅读，也易于机器解析和生成；  
* JSON是独立于语言的，也就是说不管什么语言，都可以解析JSON。  

##### 使用JSON的好处：  
* json的长度很短小；  
* 读写速度更快；  
* 可以使用JS内建的方法直接进行解析，转换成JS对象  
 
##### JSON数据的书写格式  
* “名称”：“值”，“值2”，…  
* JSON的值可以是：数字、字符串、逻辑值、数组、对象、null  
		  
##### 将responseText转换成对象的方式  
1. eval() 计算某个字符串，并执行其中的JS代码  
    eval方法会直接执行穿入其中的字符串代码，存在安全问题，使用eval（）方法可以将从服务器得到的返回信息responseText字符串用括号括起来作为一个整体，经过eval方法转换成一个对象。
2. JSON对象的两个方法
	JSON.parse() 将JSON字符串转换成JS值
	JSON.stringify() 将JS值转化成JSON字符串	  

### 跨域  
* 一个域名地址的组成：     
		当协议、子域名、主域名、端口号中的任意一个不相同是，都是不同域；  
		不同域之间相互请求资源就算做是“跨域”。  
		JS出于安全方面的考虑，不允许跨域调用其他页面的对象(同源策略限制)。  
	
* 跨域解决方案：  
		1.跨域资源共享  
		2.使用的JSONP(常用)  
		3.修改document.domain  
		4.使用window.name  

* 使用JSONP解决跨域  
		JSONP(JSON with padding)填充式json；  
        是一种跨域解决方案  

##### JSONP由两部分组成：
回调函数和数据(回调函数是当页面得到响应时将要做出的操作，数据就会作为参数传入到回调函数中)  
##### 直接使用XHR请求不同域上的数据是不被允许的，但是在页面上引入不同域的JS脚本文件缺失可以的。JSONP正是利用这个特性来实现的。这个过程就可以被描述为：  
    1.通过script标签引入JS文件(script标签的src属性是可以跨域可以携带数据的)*类似的还有href属性也是不存在域的问题的。  
    2.JS文件载入成功后执行URL参数中指定的函数  
  
## jQuery中的Ajax方法  
`$.ajax()`
```    
$.ajax({    
    url:“”，  //请求地址  
    type：“”，  //请求方式  
    async：“”，  //同步或是异步  
    dataType：“”，  //响应返回的数据格式  
    success：function(){}  //请求成功后执行的函数  
})  
$.get(URL，callback)  
$.post(URL，data,callback)  
$.getJson()  
```
Ajax操作函数手册 http://www.w3school.com.cn/jquery/jquery_ref_ajax.asp
